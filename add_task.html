<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ScheduleSV | برنامه‌ریزی تیم</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      direction: rtl;
    }
    .container {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      width: 400px;
      text-align: center;
    }
    h1 {
      color: #007bff;
      margin-bottom: 15px;
    }
    .live-time {
      font-weight: bold;
      font-size: 20px;
      background: #eee;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .manual-inputs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }
    .manual-inputs input {
      width: 50px;
      text-align: center;
      padding: 5px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ScheduleSV</h1>
    <div>🕰 زمان:</div>
    <div class="live-time" id="liveTime">در حال بارگذاری...</div>

    <div>📄 تعیین دستی زمان شروع:</div>
    <div class="manual-inputs">
      <input type="number" id="second" min="0" max="59">
      <input type="number" id="minute" min="0" max="59">
      <input type="number" id="hour" min="0" max="23">
      <span>-</span>
      <input type="number" id="day" min="1" max="31">
      <input type="number" id="month" min="1" max="12">
      <input type="number" id="year" min="1300" max="1500">
    </div>

    <button>ثبت فعالیت</button>
  </div>

  <script>
    let manualEdited = false;

    const yearInput = document.getElementById("year");
    const monthInput = document.getElementById("month");
    const dayInput = document.getElementById("day");
    const hourInput = document.getElementById("hour");
    const minuteInput = document.getElementById("minute");
    const secondInput = document.getElementById("second");

    const inputs = [yearInput, monthInput, dayInput, hourInput, minuteInput];

    inputs.forEach(input => {
      input.addEventListener("input", () => {
        manualEdited = true;
      });
    });

    function pad(n) {
      return n.toString().padStart(2, '0');
    }

    async function fetchTime() {
      try {
        const res = await fetch("https://schedule-time-server.onrender.com/api/time");
        const data = await res.json();
        const t = data.jalali;

        // نمایش در بخش اصلی زنده
        document.getElementById("liveTime").textContent = `${t.year}/${pad(t.month)}/${pad(t.day)} - ${pad(t.hour)}:${pad(t.minute)}:${pad(t.second)}`;

        // در صورت عدم ویرایش دستی، مقداردهی اولیه یا آپدیت زنده
        if (!manualEdited) {
          yearInput.value = t.year;
          monthInput.value = pad(t.month);
          dayInput.value = pad(t.day);
          hourInput.value = pad(t.hour);
          minuteInput.value = pad(t.minute);
          secondInput.value = pad(t.second);
        }
      } catch (err) {
        document.getElementById("liveTime").textContent = "❌ خطا در دریافت زمان از سرور";
      }
    }

    fetchTime();
    setInterval(fetchTime, 1000);
  </script>
</body>
</html>

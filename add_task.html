<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ScheduleSV | ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ™€åŸÖ</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background: white;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 700px;
        }
        h2 {
            color: #007bff;
        }
        .time-display {
            font-size: 20px;
            background-color: #e9e9e9;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        .time-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .time-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .time-controls span.separator {
            font-size: 18px;
            margin: 0 5px;
            align-self: center;
            padding-top: 30px;
        }
        .time-input {
            width: 60px;
            padding: 8px;
            text-align: center;
            font-size: 16px;
        }
        .time-input:disabled {
            color: #aaa;
            background-color: #eee;
        }
        .time-controls button {
            padding: 2px 6px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .time-controls button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .submit-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>ScheduleSV</h2>
    <div class="time-display" id="live-time">ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...</div>
    <label>üìù ÿ™ÿπ€å€åŸÜ ÿØÿ≥ÿ™€å ÿ≤ŸÖÿßŸÜ ÿ¥ÿ±Ÿàÿπ:</label>
    <div class="time-row">
        <div class="time-controls">
            <button onclick="adjustTime('year', 1)" id="year-plus">+</button>
            <input class="time-input" id="year" readonly>
            <button onclick="adjustTime('year', -1)" id="year-minus">-</button>
        </div>
        <span class="separator">/</span>
        <div class="time-controls">
            <button onclick="adjustTime('month', 1)" id="month-plus">+</button>
            <input class="time-input" id="month" readonly>
            <button onclick="adjustTime('month', -1)" id="month-minus">-</button>
        </div>
        <span class="separator">/</span>
        <div class="time-controls">
            <button onclick="adjustTime('day', 1)" id="day-plus">+</button>
            <input class="time-input" id="day" readonly>
            <button onclick="adjustTime('day', -1)" id="day-minus">-</button>
        </div>
        <span class="separator">-</span>
        <div class="time-controls">
            <button onclick="adjustTime('hour', 1)" id="hour-plus">+</button>
            <input class="time-input" id="hour" readonly>
            <button onclick="adjustTime('hour', -1)" id="hour-minus">-</button>
        </div>
        <span class="separator">:</span>
        <div class="time-controls">
            <button onclick="adjustTime('minute', 1)" id="minute-plus">+</button>
            <input class="time-input" id="minute" readonly>
            <button onclick="adjustTime('minute', -1)" id="minute-minus">-</button>
        </div>
        <span class="separator">:</span>
        <div class="time-controls">
            <input class="time-input" id="second" disabled>
        </div>
    </div>
    <button class="submit-btn">ÿ´ÿ®ÿ™ ŸÅÿπÿßŸÑ€åÿ™</button>
</div>
<script>
    let currentTime = null;
    let selectedTime = null;

    async function fetchTime() {
        try {
            const response = await fetch('https://schedule-time-server.onrender.com/api/time');
            const data = await response.json();
            currentTime = { ...data.jalali };
            selectedTime = { ...data.jalali };
            updateLiveTime();
            updateManualFields();
        } catch (e) {
            document.getElementById('live-time').innerText = 'ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ ÿ≤ŸÖÿßŸÜ ÿßÿ≤ ÿ≥ÿ±Ÿàÿ±';
        }
    }

    function updateLiveTime() {
        const { year, month, day, hour, minute, second } = currentTime;
        document.getElementById('live-time').innerText = `${year}/${String(month).padStart(2,'0')}/${String(day).padStart(2,'0')} - ${String(hour).padStart(2,'0')}:${String(minute).padStart(2,'0')}:${String(second).padStart(2,'0')}`;
        document.getElementById('second').value = String(second).padStart(2, '0');
        setTimeout(() => {
            currentTime.second++;
            if (currentTime.second >= 60) {
                currentTime.second = 0;
                currentTime.minute++;
                if (currentTime.minute >= 60) {
                    currentTime.minute = 0;
                    currentTime.hour++;
                    if (currentTime.hour >= 24) {
                        currentTime.hour = 0;
                        currentTime.day++;
                        // Note: Extend with month/year change as needed
                    }
                }
            }
            updateLiveTime();
        }, 1000);
    }

    function updateManualFields() {
        const fields = ['year', 'month', 'day', 'hour', 'minute'];
        fields.forEach(field => {
            document.getElementById(field).value = selectedTime[field];
        });
        updateButtonStates();
    }

    function adjustTime(field, delta) {
        const newVal = selectedTime[field] + delta;
        const tempTime = { ...selectedTime, [field]: newVal };
        if (!isBeforeCurrent(tempTime)) {
            selectedTime[field] = newVal;
            updateManualFields();
        }
    }

    function isBeforeCurrent(time) {
        const fields = ['year', 'month', 'day', 'hour', 'minute'];
        for (let i = 0; i < fields.length; i++) {
            const key = fields[i];
            if (time[key] > currentTime[key]) return false;
            if (time[key] < currentTime[key]) return true;
        }
        return true;
    }

    function updateButtonStates() {
        const fields = ['year', 'month', 'day', 'hour', 'minute'];
        fields.forEach(field => {
            const minusBtn = document.getElementById(`${field}-minus`);
            const plusBtn = document.getElementById(`${field}-plus`);

            const tempDec = { ...selectedTime, [field]: selectedTime[field] - 1 };
            const tempInc = { ...selectedTime, [field]: selectedTime[field] + 1 };

            minusBtn.disabled = isBeforeCurrent(tempDec);
            plusBtn.disabled = false; // always allow increase
        });
    }

    fetchTime();
</script>
</body>
</html>
